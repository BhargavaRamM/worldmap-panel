{"version":3,"sources":["../src/worldmap.js"],"names":["_","L","tileServers","url","attribution","subdomains","WorldMap","ctrl","mapContainer","createMap","circles","mapCenter","window","latLng","parseFloat","panel","mapCenterLatitude","mapCenterLongitude","map","worldCopyJump","center","fitWorld","zoomIn","parseInt","initialZoom","panTo","selectedTileServer","tileServer","tileLayer","maxZoom","reuseTiles","detectRetina","addTo","legend","control","position","onAdd","_div","DomUtil","create","update","thresholds","data","legendHtml","colors","index","length","getColor","innerHTML","locations","sort","dataPoints","isEqual","circlesLayer","clearLayers","removeCircles","needToRedrawCircles","clearCircles","createCircles","updateCircles","forEach","dataPoint","locationName","push","createCircle","addCircles","circle","find","cir","options","location","key","setRadius","calcCircleSize","value","setStyle","color","fillColor","fillOpacity","unbindPopup","createPopup","valueRounded","circleMarker","locationLatitude","locationLongitude","radius","dataPointValue","circleMinSize","circleMaxSize","valueRange","dataFactor","lowestValue","circleSizeRange","unit","unitSingular","unitPlural","label","trim","bindPopup","point","on","onMouseOver","evt","layer","target","bringToFront","openPopup","onMouseOut","closePopup","first","invalidateSize","mapCenterMoved","Icon","Default","imagePath","console","log","hasLayer","marker","removeLayer","removeFrom","layerGroup","zoomFactor","setZoom","removeLegend","remove"],"mappings":"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","file":"worldmap.js","sourcesContent":["import _ from 'lodash';\n/* eslint-disable id-length, no-unused-vars */\nimport L from './leaflet';\n/* eslint-disable id-length, no-unused-vars */\n\nconst tileServers = {\n  'CartoDB Positron': { url: 'https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}.png', attribution: '&copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a> &copy; <a href=\"http://cartodb.com/attributions\">CartoDB</a>', subdomains: 'abcd'},\n  'CartoDB Dark': {url: 'https://cartodb-basemaps-{s}.global.ssl.fastly.net/dark_all/{z}/{x}/{y}.png', attribution: '&copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a> &copy; <a href=\"http://cartodb.com/attributions\">CartoDB</a>', subdomains: 'abcd'}\n};\n\nexport default class WorldMap {\n  constructor(ctrl, mapContainer) {\n    this.ctrl = ctrl;\n    this.mapContainer = mapContainer;\n    this.createMap();\n    this.circles = [];\n  }\n\n  createMap() {\n    const mapCenter = window.L.latLng(parseFloat(this.ctrl.panel.mapCenterLatitude), parseFloat(this.ctrl.panel.mapCenterLongitude));\n    this.map = window.L.map(this.mapContainer, {worldCopyJump: true, center: mapCenter})\n      .fitWorld()\n      .zoomIn(parseInt(this.ctrl.panel.initialZoom, 10));\n    this.map.panTo(mapCenter);\n\n    const selectedTileServer = tileServers[this.ctrl.tileServer];\n    window.L.tileLayer(selectedTileServer.url, {\n      maxZoom: 18,\n      subdomains: selectedTileServer.subdomains,\n      reuseTiles: true,\n      detectRetina: true,\n      attribution: selectedTileServer.attribution\n    }).addTo(this.map);\n  }\n\n  createLegend() {\n    this.legend = window.L.control({position: 'bottomleft'});\n    this.legend.onAdd = () => {\n      this.legend._div = window.L.DomUtil.create('div', 'info legend');\n      this.legend.update();\n      return this.legend._div;\n    };\n\n    this.legend.update = () => {\n      const thresholds = this.ctrl.data.thresholds;\n      let legendHtml = '';\n      legendHtml += '<i style=\"background:' + this.ctrl.panel.colors[0] + '\"></i> ' +\n          '&lt; ' + thresholds[0] + '<br>';\n      for (let index = 0; index < thresholds.length; index += 1) {\n        legendHtml +=\n          '<i style=\"background:' + this.getColor(thresholds[index] + 1) + '\"></i> ' +\n          thresholds[index] + (thresholds[index + 1] ? '&ndash;' + thresholds[index + 1] + '<br>' : '+');\n      }\n      this.legend._div.innerHTML = legendHtml;\n    };\n    this.legend.addTo(this.map);\n  }\n\n  needToRedrawCircles() {\n    if (this.circles.length === 0 && this.ctrl.data.length > 0) return true;\n    if (this.circles.length !== this.ctrl.data.length) return true;\n    const locations = _.map(_.map(this.circles, 'options'), 'location').sort();\n    const dataPoints = _.map(this.ctrl.data, 'key').sort();\n    return !_.isEqual(locations, dataPoints);\n  }\n\n  clearCircles() {\n    if (this.circlesLayer) {\n      this.circlesLayer.clearLayers();\n      this.removeCircles(this.circlesLayer);\n      this.circles = [];\n    }\n  }\n\n  drawCircles() {\n    if (this.needToRedrawCircles()) {\n      this.clearCircles();\n      this.createCircles();\n    } else {\n      this.updateCircles();\n    }\n  }\n\n  createCircles() {\n    const circles = [];\n    this.ctrl.data.forEach((dataPoint) => {\n      if (!dataPoint.locationName) return;\n      circles.push(this.createCircle(dataPoint));\n    });\n    this.circlesLayer = this.addCircles(circles);\n    this.circles = circles;\n  }\n\n  updateCircles() {\n    this.ctrl.data.forEach((dataPoint) => {\n      if (!dataPoint.locationName) return;\n\n      const circle = _.find(this.circles, (cir) => { return cir.options.location === dataPoint.key; });\n\n      if (circle) {\n        circle.setRadius(this.calcCircleSize(dataPoint.value || 0));\n        circle.setStyle({\n          color: this.getColor(dataPoint.value),\n          fillColor: this.getColor(dataPoint.value),\n          fillOpacity: 0.5,\n          location: dataPoint.key\n        });\n        circle.unbindPopup();\n        this.createPopup(circle, dataPoint.locationName, dataPoint.valueRounded);\n      }\n    });\n  }\n\n\n  createCircle(dataPoint) {\n    const circle = window.L.circleMarker([dataPoint.locationLatitude, dataPoint.locationLongitude], {\n      radius: this.calcCircleSize(dataPoint.value || 0),\n      color: this.getColor(dataPoint.value),\n      fillColor: this.getColor(dataPoint.value),\n      fillOpacity: 0.5,\n      location: dataPoint.key\n    });\n\n    this.createPopup(circle, dataPoint.locationName, dataPoint.valueRounded);\n    return circle;\n  }\n\n  calcCircleSize(dataPointValue) {\n    const circleMinSize = parseInt(this.ctrl.panel.circleMinSize, 10);\n    const circleMaxSize = parseInt(this.ctrl.panel.circleMaxSize, 10);\n\n    if (this.ctrl.data.valueRange === 0) {\n      return circleMaxSize;\n    }\n\n    const dataFactor = (dataPointValue - this.ctrl.data.lowestValue) / this.ctrl.data.valueRange;\n    const circleSizeRange = this.ctrl.panel.circleMaxSize - circleMinSize;\n\n    return (circleSizeRange * dataFactor) + circleMinSize;\n  }\n\n  createPopup(circle, locationName, value) {\n    const unit = value && value === 1 ? this.ctrl.panel.unitSingular : this.ctrl.panel.unitPlural;\n    const label = (locationName + ': ' + value + ' ' + (unit || '')).trim();\n    circle.bindPopup(label, {'offset': window.L.point(0, -2), 'className': 'worldmap-popup', 'closeButton': false});\n\n    circle.on('mouseover', function onMouseOver(evt) {\n      const layer = evt.target;\n      layer.bringToFront();\n      this.openPopup();\n    });\n    circle.on('mouseout', function onMouseOut() {\n      circle.closePopup();\n    });\n  }\n\n  getColor(value) {\n    for (let index = this.ctrl.data.thresholds.length; index > 0; index -= 1) {\n      if (value >= this.ctrl.data.thresholds[index - 1]) {\n        return this.ctrl.panel.colors[index];\n      }\n    }\n    return _.first(this.ctrl.panel.colors);\n  }\n\n  resize() {\n    this.map.invalidateSize();\n  }\n\n  panToMapCenter() {\n    this.map.panTo([parseFloat(this.ctrl.panel.mapCenterLatitude), parseFloat(this.ctrl.panel.mapCenterLongitude)]);\n    this.ctrl.mapCenterMoved = false;\n    window.L.Icon.Default.imagePath = '/public/plugins/grafana-worldmap-panel/images/';\n    console.log(this.map.hasLayer(this.map));\n    if(this.marker) {\n       console.log(\"In updating marker block\");\n       console.log(\"removing marker\");\n       this.map.removeLayer(this.marker);\n       console.log(\"adding marker\");\n       this.marker = window.L.marker([parseFloat(this.ctrl.panel.mapCenterLatitude), parseFloat(this.ctrl.panel.mapCenterLongitude)]).addTo(this.map);\n       console.log(\"Updated the marker\");\n    }\n    else {\n    console.log(\"Adding a new marker\");\n    this.marker = window.L.marker([parseFloat(this.ctrl.panel.mapCenterLatitude), parseFloat(this.ctrl.panel.mapCenterLongitude)]).addTo(this.map);\n    }\n  }\n\n  removeLegend() {\n    this.legend.removeFrom(this.map);\n    this.legend = null;\n  }\n\n  addCircles(circles) {\n    return window.L.layerGroup(circles).addTo(this.map);\n  }\n\n  removeCircles() {\n    this.map.removeLayer(this.circlesLayer);\n  }\n\n  setZoom(zoomFactor) {\n    this.map.setZoom(parseInt(zoomFactor, 10));\n  }\n\n  remove() {\n    this.circles = [];\n    if (this.circlesLayer) this.removeCircles();\n    if (this.legend) this.removeLegend();\n    this.map.remove();\n  }\n}\n"]}